(()=>{"use strict";new class{constructor(e){this.container=e,this.columns=["TO DO","IN PROGRESS","DONE"],this.drawing=!1,this.currentItem=null,this.shadowItem=null}init(){this.creatColumns(),this.loadFromLocalStorage(),this.addNewCardEventListener(),this.focusCardEventListener(),this.mouseMoveCardEventListener()}addNewCardEventListener(){this.container.addEventListener("click",(e=>{if("BUTTON"===e.target.tagName&&e.target.classList.contains("add-card-btn"))this.createItemInput(e.target.parentNode);else if("A"===e.target.tagName&&e.target.classList.contains("close-add-new-card"))this.removeNewCardOpenedWindow();else if("INPUT"===e.target.tagName&&e.target.classList.contains("js-add-card")){const t=document.querySelector(".card-textarea").value;t.length>0&&(this.createItem(t,e.target.parentNode.parentNode.parentNode),this.removeNewCardOpenedWindow(),this.mouseMoveCardEventListener(),this.saveToLocalStorage())}else"SPAN"===e.target.tagName&&e.target.classList.contains("icon-close")&&(e.target.parentNode.remove(),this.saveToLocalStorage())}))}focusCardEventListener(){this.container.addEventListener("mouseover",(e=>{"LI"===e.target.tagName&&e.target.classList.contains("list-card")&&e.target.classList.add("active-card")})),this.container.addEventListener("mouseout",(e=>{"LI"===e.target.tagName&&e.target.classList.contains("list-card")&&"SPAN"!==e.relatedTarget.tagName&&e.target.classList.remove("active-card")}))}mouseMoveCardEventListener(){document.querySelectorAll("li.list-card").forEach((e=>{e.addEventListener("mousedown",(e=>{e.target.classList.contains("list-card")&&(e.preventDefault(),this.drawing=!0,this.currentItem=e.target,this.shadowItem=this.currentItem.cloneNode(!0),this.shadowItem.style.opacity="0",this.shadowItem.classList.add("clone"),this.currentItem.classList.add("dragged"),this.currentItem.style.left=e.pageX-this.currentItem.offsetWidth/2+"px",this.currentItem.style.top=e.pageY-this.currentItem.offsetHeight/2+"px",this.container.addEventListener("mousemove",(e=>{if(e.preventDefault(),!0===this.drawing&&this.currentItem){this.currentItem.style.left=e.pageX-this.currentItem.offsetWidth/2+"px",this.currentItem.style.top=e.pageY-this.currentItem.offsetHeight/2+"px";const t=document.elementFromPoint(e.clientX,e.clientY);t.parentNode.classList.contains("list")?t.parentNode.querySelector("ul").insertAdjacentElement("beforeend",this.shadowItem):"LI"!==t.tagName||t.classList.contains("clone")?t.parentNode.classList.contains("list-items")&&t.parentNode.insertAdjacentElement("beforeend",this.shadowItem):t.insertAdjacentElement("afterend",this.shadowItem)}})),this.container.addEventListener("mouseup",(e=>{e.preventDefault();const t=document.elementFromPoint(e.clientX,e.clientY);!0===this.drawing&&this.currentItem&&(t.parentNode.classList.contains("list")?this.cardMove(t.parentNode.querySelector("ul"),e):t.parentNode.classList.contains("list-items")?this.cardMove(t.parentNode,e):"LI"!==t.tagName||t.classList.contains("clone")||this.cardMove(t,e))})))}))}))}cardMove(e,t){this.shadowItem.remove(),e.insertAdjacentElement("beforeend",this.currentItem),this.currentItem.classList.remove("dragged"),this.currentItem.removeAttribute("style"),this.currentItem=null,this.drawing=!1,this.saveToLocalStorage()}creatColumns(){const e=document.createElement("section");e.className="lists-container",this.container.insertAdjacentElement("beforeend",e);for(let t of this.columns){const s=document.createElement("div");s.className="list",e.insertAdjacentElement("beforeend",s);const a=document.createElement("h3");a.className="list-title",a.innerHTML=`${t}`,s.insertAdjacentElement("beforeend",a);const r=document.createElement("ul");r.className="list-items",s.insertAdjacentElement("beforeend",r),s.insertAdjacentHTML("beforeend",'<button class="add-card-btn btn">Add a card</button>')}}removeNewCardOpenedWindow(){const e=document.querySelector(".new-card");e&&e.remove()}createItemInput(e){this.removeNewCardOpenedWindow(),e.querySelector("UL").insertAdjacentHTML("beforeend",'\n        <div class="new-card">\n          <textarea class="card-textarea" placeholder="Ввести заголовок для этой карточки" style="overflow: hidden; word-wrap: break-word; height: 60px;"></textarea>\n          <div>\n            <input class="nch-button nch-button--primary confirm mod-compact js-add-card" type="submit" value="Добавить карточку">\n            <a class="icon-lg icon-close dark-hover js-cancel close-add-new-card" href="#"></a>\n          </div>\n        </div>\n      ')}createItem(e,t){t.insertAdjacentHTML("beforeend",`\n        <li class="list-card js-member-droppable ui-droppable">${e}\n          <span class="icon-lg icon-close list-card-operation dark-hover js-open-quick-card-editor js-card-menu"></span>\n        </li>  \n      `)}saveToLocalStorage(){this.layers=[],document.querySelectorAll("div.list").forEach((e=>{this.cards=[];let t=e.querySelector("H3").innerHTML;e.querySelectorAll("li").forEach((e=>{this.cards.push(e.textContent)})),this.layers.push([t,this.cards])})),localStorage.setItem("trello",JSON.stringify(this.layers))}loadFromLocalStorage(){try{const e=JSON.parse(localStorage.getItem("trello"));if(null!==e){let t=document.querySelectorAll("div.list");for(let s of e)for(let e of t)if(e.querySelector("H3").innerHTML===s[0]){let t=e.querySelector("ul");for(let e of s[1])this.createItem(e,t)}}}catch(e){}}}(document.body).init()})();